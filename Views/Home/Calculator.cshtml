@{
    ViewData["Title"] = "CustosCarbon 碳足跡計算機";
}

@section HeadContent {
    <!-- 💅 粉白主題樣式 -->
    <link rel="stylesheet" href="~/css/style.css" asp-append-version="true" />

    <!-- 📊 圖表＋PDF -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.3/dist/jspdf.plugin.autotable.min.js"></script>
}

<div class="container fade-in">
  <h1 class="calc-title">碳足跡計算器</h1>
  <p class="calc-subtitle">輸入排放來源與數量，系統會自動計算你的碳足跡噢。</p>

  <!-- 💡 提示條 -->
  <div class="keyword-hint">
    💡 可輸入關鍵字：<b>交通、能源、飲食、日常用品、步行、自行車</b>
  </div>

  <!-- 🚀 一鍵加入 -->
  <div class="quick-actions-row">
    <button class="btn-soft" type="button" onclick="quickAdd('transport')">🚗 一鍵加入交通項目</button>
    <button class="btn-soft" type="button" onclick="quickAdd('food')">🍱 一鍵加入飲食項目</button>
    <button class="btn-soft" type="button" onclick="quickAdd('energy')">⚡ 一鍵加入用電項目</button>
    <button class="btn-soft" type="button" onclick="quickAdd('green')">🌿 一鍵加入綠色出行</button>
  </div>

  <!-- 🔎 搜尋 × 🔢 使用量 × ➕ 加入紀錄（同一行，左右排列；每組上下關係） -->
  <section class="input-strip card-rounded card-shadow">
    <div class="input-row">
      <!-- 項目搜尋 -->
      <div class="input-col search-col">
        <label for="search">項目搜尋</label>
        <input id="search" class="styled-input"
               type="text"
               placeholder="輸入關鍵字查詢"
               oninput="showSuggestions(this.value)" autocomplete="off" />
        <div id="suggestions" class="suggestions-box" style="display:none;"></div>
        
      </div>

      <!-- 使用量 -->
      <div class="input-col usage-col">
  <label for="usage">使用量</label>
  <div class="usage-wrapper">
    <input id="usage" class="styled-input" type="number" min="0" step="0.1" placeholder="輸入使用量" />
    <span id="unitHint" class="unit-hint"></span>
  </div>
</div>

      <!-- 加入紀錄 -->
      <div class="input-col button-col">
        <label>&nbsp;</label>
        <button id="btnAdd" class="btn-pink full-btn" type="button" onclick="addRecord()">＋ 加入紀錄</button>
      </div>
    </div>
  </section>

  <!-- 🧾 我的碳排紀錄 -->
  <section class="table-card card-rounded card-shadow">
    <h2>🧾 我的碳排紀錄</h2>
    <div class="table-responsive">
      <table id="recordTable">
        <thead>
          <tr>
            <th>項目名稱</th>
            <th>使用量</th>
            <th>排放係數 (kgCO₂e)</th>
            <th>總排放量</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="table-actions">
      <button class="btn-outline" type="button" onclick="addRecord()">＋ 新增排放項目</button>
      <button class="btn-outline" type="button" onclick="clearAll()">🗑 清空所有</button>
    </div>
  </section>

  <!-- 📊 總量與圖表 -->
  <section class="summary-card card-rounded card-shadow">
    <div class="summary-flex">
      <div class="total-display">
        🌍 總碳排量：
        <span id="totalEmission">0.00</span> kgCO₂e
      </div>
      <div id="chart-container">
        <canvas id="emissionChart"></canvas>
      </div>
    </div>

    <div class="export-row">
      <button class="btn-soft" type="button" id="downloadBtn" onclick="downloadPDF()">📄 匯出 PDF 報告</button>
    </div>
  </section>

  <!-- ✅ 自訂項目容器 -->
  <section id="customItems"></section>
</div>

@section Scripts {
    <!-- ✅ 只保留主要腳本，移除重複與 transport_factors -->
    <script src="~/js/calculator.js" asp-append-version="true"></script>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            console.log("✅ CustosCarbon MVC Calculator Ready");

            try {
                // 確保資料完全載入後才啟用按鈕與互動
                if (typeof initCalculator === "function") {
                    await initCalculator();
                    console.log("🌸 初始化完成，碳足跡計算器可用");
                } else {
                    console.error("⚠️ 找不到 initCalculator() 函式，請確認 calculator.js 是否載入正確");
                }
            } catch (err) {
                console.error("❌ 初始化失敗：", err);
            }
        });
    </script>
}

